ip_in中校验和检验，用buf替代iht做检验，ip是可以通过的，但是icmp不可以

在写icmp时发现了一个奇怪的现象：
在ip.c中的ip_in函数，对于校验和验证，我一开始是传入了buf指针而不是buf中的ip报头ip_hdr_t指针，这在ip测试是没有问题的，
但是在写icmp时，发现最后结果会少两个数据包，改回ip_hdr_t指针后正常，我想问一下为什么在ip测试中检测不到这个错误？按道理来说在比对pcap的时候应该会有不一样的数据（传入buf指针的话），想请老师帮忙想一下到底是什么原因
